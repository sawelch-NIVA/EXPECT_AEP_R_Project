[
  {
    "objectID": "output/visualisation_quarto.html",
    "href": "output/visualisation_quarto.html",
    "title": "EXPECT Copper AEP",
    "section": "",
    "text": "Port property doesn’t work…\nCode\nlibrary(STOPeData)\nlibrary(DT)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(forcats)\nlibrary(viridis)\nlibrary(stringr)\nlibrary(ggridges)\nlibrary(ggh4x)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(ggiraph)\nlibrary(leaflet)\nlibrary(sf)\nlibrary(shiny)\nlibrary(dplyr)\nlibrary(bslib)\nlibrary(ggtext)\n\nsource(\"_targets.R\")\ntar_make()\n\n\n# load in any data we need from the targets workflow\nliterature_merged_data &lt;- tar_read(load_literature_pqt)\nliterature_reference_data &lt;- tar_read(reference_data)\nliterature_campaign_data &lt;- tar_read(campaign_data)\nliterature_sites_data &lt;- tar_read(sites_data)\nliterature_qc &lt;- tar_read(data_quality_report)\nwgs84_geo &lt;- tar_read(wgs84_geography)\n\nspecies_names &lt;- arrow::read_parquet(\"data/clean/ecotox_2025_06_12_species.parquet\")\nspecies_lookup &lt;- species_names |&gt;\n  with(setNames(common_name, latin_name))\n\ncopper_toxicity_thresholds &lt;- tar_read(copper_toxicity_thresholds)\n# Define threshold colors based on the report ----\nthreshold_colours &lt;- c(\n  \"Background (I)\" = \"#0070C0\", # Blue\n  \"Good (II)\" = \"#00B050\", # Green\n  \"Moderate (III)\" = \"#FFC000\", # Yellow\n  \"Poor (IV)\" = \"#FF6600\", # Orange\n  \"Very Poor (V)\" = \"#FF0000\" # Red\n)\n\ncompartment_colours &lt;- c(\n  # Aquatic ----\n  \"Freshwater\" = \"#4A90E2\", # clear blue\n  \"Marine/Salt Water\" = \"#1E5A8E\", # deep ocean blue\n  \"Brackish/Transitional Water\" = \"#6BA5C8\", # mid-blue (between fresh/marine)\n  \"Groundwater\" = \"#2C5F7B\", # darker, subdued blue\n  \"Wastewater\" = \"#8B7355\", # murky brown\n  \"Liquid Growth Medium\" = \"#9FD8CB\", # pale greenish-blue\n  \"Rainwater\" = \"#B3D9FF\", # light sky blue\n  \"Stormwater\" = \"#607D8B\", # grey-blue\n  \"Leachate\" = \"#6B5344\", # dark muddy brown\n  \"Aquatic Sediment\" = \"#EBCF1B\", # your existing yellow\n  \"Porewater\" = \"#7FA0B8\", # muted blue-grey\n  \"Sludge\" = \"#67AB33\", # your existing green\n\n  # Atmospheric ----\n  \"Indoor Air\" = \"#E8F4F8\", # very pale blue-grey\n  \"Outdoor Air\" = \"#87CEEB\", # sky blue\n\n  # Terrestrial ----\n  \"Terrestrial Biological Residue\" = \"#8B6F47\", # organic brown\n  \"Soil H Horizon (Peat)\" = \"#3E2723\", # very dark brown\n  \"Soil O Horizon (Organic)\" = \"#5D4037\", # dark organic brown\n  \"Soil A Horizon (Topsoil)\" = \"#795548\", # medium brown\n  \"Soil E Horizon (Mineral)\" = \"#A1887F\", # light greyish-brown\n  \"Soil S Horizon (Mineral)\" = \"#BCAAA4\", # pale brown-grey\n  \"Soil C Horizon (Parent Material)\" = \"#D7CCC8\", # very pale brown\n  \"Soil R Horizon (Bedrock)\" = \"#9E9E9E\", # grey\n\n  # Biota ----\n  \"Biota, Terrestrial\" = \"#558B2F\", # forest green\n  \"Biota, Aquatic\" = \"#00695C\", # teal\n  \"Biota, Atmospheric\" = \"#B39DDB\", # light purple (birds/insects)\n  \"Biota, Other\" = \"#9C27B0\" # distinct purple\n)\n\n# Helper function for sample sizes\ncalculate_sample_sizes &lt;- function(data) {\n  data |&gt;\n    group_by(\n      REFERENCE_ID,\n      OCEAN_COUNTRY,\n      SITE_GEOGRAPHIC_FEATURE,\n      ENVIRON_COMPARTMENT_SUB\n    ) |&gt;\n    summarise(total_n = sum(MEASURED_N, na.rm = TRUE), .groups = \"drop\")\n}"
  },
  {
    "objectID": "output/visualisation_quarto.html#dataset-overview",
    "href": "output/visualisation_quarto.html#dataset-overview",
    "title": "EXPECT Copper AEP",
    "section": "Dataset Overview",
    "text": "Dataset Overview\n\nTo Do\n\nAdd probable contamination sources to each paper\nMake sure we handle missing characters properly\nReach out to Dag or Jens to ask if MD have any copper emissions data\nTalk to Marianne from reference group (or anyone else on the reference group)\nGet more data in\nMake network diagram visualise uncertainty, etc.\nFunctional and risk assessment trophic levels may not be perfectly aligned\n\nmight be better off using ERA grouping - talk to Li about it\n\nFix icon colouration in map"
  },
  {
    "objectID": "output/visualisation_quarto.html#sec-data-quality",
    "href": "output/visualisation_quarto.html#sec-data-quality",
    "title": "EXPECT Copper AEP",
    "section": "Data Quality Overview",
    "text": "Data Quality Overview\nDataset contains 377 rows from 19 references across 87 sites.\nIssues identified:\n\nMeasurements: 3 rows (1 references) missing all measurement data (value, LOQ, and LOD)\nSample size: 0 rows (0 references) missing or zero sample size\nMethods: 0 rows (0 references) missing method information\nUncertainty: 286 rows (7 references) missing uncertainty type\nSite data: 0 sites (0 references) missing location/geographic data\nBiota data: 0 rows (0 references) missing species/tissue information\n\n\n\n\n\n\n\nNoteMissing Data\n\n\n\n\n\n\nMissing Measurements\nRows where measured value, LOQ, and LOD are all missing.\nKnown issues:\n\n2025PelkonenEnvironmentalImpactOf does not report LOD/LOQ values in main paper or ESI.\n\n\n\n\n\n\n\n\n\nMissing Sample Size\nRows where MEASURED_N is missing or zero.\n\n\n*No missing sample sizes found.*\n\n\n\n\nMissing Methods\nRows missing any of: analytical protocol, extraction protocol, fractionation protocol, or sampling protocol.\n\n\n*No missing methods found.*\n\n\n\n\nMissing Uncertainty\nRows where UNCERTAINTY_TYPE or UNCERTAINTY_*_STANDARD are missing.\n\n\n\n\n\n\n\n\nMissing Site Data\nSites missing coordinates, geographic features, country, or ocean information.\n\n\n*No missing site data found.*\n\n\n\n\nMissing Biota Data\nBiota samples missing species, tissue, lifestage, gender, or species group.\n\n\n*No missing biota data found.*"
  },
  {
    "objectID": "output/visualisation_quarto.html#literature-summary",
    "href": "output/visualisation_quarto.html#literature-summary",
    "title": "EXPECT Copper AEP",
    "section": "Literature Summary",
    "text": "Literature Summary\nTable 1 provides a comprehensive summary of all papers included in this analysis, showing the number of measurements extracted from each study and their associated sampling campaigns.\n\n\nCode\nliterature_merged_data |&gt;\n  dplyr::left_join(literature_reference_data) |&gt;\n  dplyr::left_join(\n    literature_campaign_data |&gt; select(CAMPAIGN_NAME_SHORT, CAMPAIGN_COMMENT)\n  ) |&gt;\n  dplyr::group_by(\n    TITLE,\n    YEAR,\n    AUTHOR,\n    CAMPAIGN_COMMENT\n  ) |&gt;\n  dplyr::reframe(SUM_N = sum(MEASURED_N)) |&gt;\n  datatable(options = list(pageLength = 5, lengthMenu = c(5, 10, 15, 20)))\n\n\n\n\nTable 1: Summary of analysed papers showing publication details, associated campaigns, and number of copper measurements extracted from each study.\n\n\n\n\n\n\n\n\n\n\n\nCompartment Coverage\n\n\nCode\n# Prepare data for plotting ----\nplot_data &lt;- literature_merged_data |&gt;\n  group_by(REFERENCE_ID, ENVIRON_COMPARTMENT_SUB) |&gt;\n  distinct() |&gt;\n  reframe(count = sum(MEASURED_N, na.rm = TRUE)) |&gt;\n  # Join year data for y-axis ordering\n  left_join(\n    literature_merged_data |&gt; distinct(REFERENCE_ID, YEAR),\n    by = \"REFERENCE_ID\"\n  ) |&gt;\n  filter(!is.na(ENVIRON_COMPARTMENT_SUB))\n\n# Calculate text color threshold ----\nthreshold_value &lt;- mean(plot_data$count, na.rm = TRUE)\n\n# Create plot ----\nggplot(\n  plot_data,\n  aes(\n    y = REFERENCE_ID,\n    x = ENVIRON_COMPARTMENT_SUB,\n    fill = count\n  )\n) +\n  geom_tile() +\n  geom_text(aes(\n    label = count,\n    color = if_else(count &gt; threshold_value, \"black\", \"white\")\n  )) +\n  scale_fill_viridis(name = \"Sample Size (n)\") +\n  scale_color_identity() +\n  theme_aep_plots() +\n  theme(\n    axis.text.x = element_text(angle = 90, hjust = 1),\n    axis.title.y = element_blank(),\n    legend.position = \"none\"\n  ) +\n  labs(x = \"Environmental Sub-Compartment\")\n\n\n\n\n\n\n\n\nFigure 1: Number of environmental sub-compartments sampled per paper. Each bar represents a unique publication, with height indicating the diversity of compartments (e.g., surface water, sediment, soil) analysed within that study.\n\n\n\n\n\n\n\nSpecies Coverage\nFigure 2 illustrates the taxonomic diversity captured across studies, highlighting which papers focused on biota measurements and the range of species groups investigated.\n\n\nCode\n# Prepare data for plotting ----\nplot_data &lt;- literature_merged_data |&gt;\n  group_by(REFERENCE_ID, SAMPLE_SPECIES) |&gt;\n  distinct() |&gt;\n  reframe(count = sum(MEASURED_N, na.rm = TRUE), SPECIES_GROUP) |&gt;\n  # Join year data for y-axis ordering\n  left_join(\n    literature_merged_data |&gt; distinct(REFERENCE_ID, YEAR),\n    by = \"REFERENCE_ID\"\n  ) |&gt;\n  filter(!is.na(SAMPLE_SPECIES)) |&gt;  distinct()\n\n# Create formatted labels\nplot_data &lt;- plot_data |&gt;\n  mutate(\n    formatted_species = glue::glue(\n      \"**{species_lookup[SAMPLE_SPECIES]}**&lt;br&gt;*({SAMPLE_SPECIES})*\"\n    )\n  )\n\n\n# Calculate text color threshold ----\nthreshold_value &lt;- 2000 # set manually, as the 2050 mussels tend to overwhelm the others\n\n# Create plot ----\n\nggplot(\n  plot_data,\n  aes(\n    y = REFERENCE_ID,  # Use the formatted label\n    x = formatted_species,\n    fill = count\n  )\n) +\n  geom_tile() +\n  geom_text(aes(\n    label = count,\n    color = if_else(count &gt; threshold_value, \"black\", \"white\")\n  )) +\n  scale_fill_viridis(name = \"Sample Size (n)\") +\n  scale_color_identity() +\n  # theme_aep_plots() + # breaks markdown\n  theme(\n    axis.text.x = element_markdown(angle = 90, hjust = 1),  # Enable markdown rendering\n    axis.title.y = element_blank(),\n    legend.position = \"none\"\n  ) +\n  labs(x = \"Sampled Species\") +\n  facet_wrap(\n    facets = vars(SPECIES_GROUP),\n    space = \"free_x\",\n    scales = \"free_x\",\n    nrow = 1\n  )\n\n\n\n\n\n\n\n\nFigure 2: Sample size per species per paper across the dataset."
  },
  {
    "objectID": "output/visualisation_quarto.html#geographic-distribution-of-sampling-sites",
    "href": "output/visualisation_quarto.html#geographic-distribution-of-sampling-sites",
    "title": "EXPECT Copper AEP",
    "section": "Geographic Distribution of Sampling Sites",
    "text": "Geographic Distribution of Sampling Sites\nFigure 3 shows the spatial distribution of all sampling locations included in the analysis. This map helps visualise the geographic scope of copper monitoring in Arctic regions and identify areas with high or low sampling intensity.\n\n\nCode\n# Turn off spherical geometry ----\nsf::sf_use_s2(FALSE)\n\n# Prepare spatial data ----\ndata_sf &lt;- literature_merged_data |&gt;\n  filter(\n    !is.na(LATITUDE),\n    !is.na(LONGITUDE),\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  st_as_sf(\n    coords = c(\"LONGITUDE\", \"LATITUDE\"),\n    crs = st_crs(\"WGS84\"),\n    remove = FALSE)\n\n  # Prepare apple data ----\n  number_of_sites &lt;- nrow(municipality_centroids())\n  sales_data_split &lt;- copper_oxide_sales() |&gt; mutate(amount_kg = amount_kg / number_of_sites,\n  average_kg = average_kg / number_of_sites)\n\n  apple_data &lt;- cross_join(municipality_centroids(), sales_data_split) |&gt;\n  group_by(name, x, y) |&gt;\n  summarise(\n    avg_copper_kg = mean(amount_kg, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |&gt;\n  st_as_sf(\n    coords = c(\"x\", \"y\"),\n    crs = st_crs(\"WGS84\"),\n    remove = FALSE\n  )\n\nenviron_compartments_vocabulary &lt;- environ_compartments_vocabulary() |&gt;\n  setdiff(c(\"Not relevant\", \"Not reported\", \"Other\"))\n\n# Create colour palette for main compartments ----\ncompartment_pal &lt;- colorFactor(\n  palette = palette.colors(n = 4, palette = \"Tableau\"),\n  domain = environ_compartments_vocabulary\n)\n\n# Create colour palette for measured values ----\nvalue_range &lt;- range(data_sf$MEASURED_VALUE_STANDARD, na.rm = TRUE)\nvalue_pal &lt;- colorNumeric(\n  palette = \"viridis\",\n  domain = value_range,\n  na.color = \"gray\"\n)\n\n# Create sub-compartment letter codes ----\nsubcomp_codes &lt;- c(\n  # Aquatic\n  \"Freshwater\" = \"F\",\n  \"Marine/Salt Water\" = \"M\",\n  \"Brackish/Transitional Water\" = \"B\",\n  \"Groundwater\" = \"G\",\n  \"Wastewater\" = \"WW\",\n  \"Liquid Growth Medium\" = \"LGM\",\n  \"Rainwater\" = \"R\",\n  \"Stormwater\" = \"SW\",\n  \"Leachate\" = \"L\",\n  \"Aquatic Sediment\" = \"AS\",\n  \"Porewater\" = \"P\",\n  \"Sludge\" = \"Sl\",\n  # Atmospheric\n  \"Indoor Air\" = \"IA\",\n  \"Outdoor Air\" = \"OA\",\n  # Terrestrial\n  \"Terrestrial Biological Residue\" = \"TBR\",\n  \"Soil H Horizon (Peat)\" = \"H\",\n  \"Soil O Horizon (Organic)\" = \"O\",\n  \"Soil A Horizon (Topsoil)\" = \"A\",\n  \"Soil E Horizon (Mineral)\" = \"E\",\n  \"Soil S Horizon (Mineral)\" = \"S\",\n  \"Soil C Horizon (Parent Material)\" = \"C\",\n  \"Soil R Horizon (Bedrock)\" = \"R\",\n  # Biota\n  \"Biota, Terrestrial\" = \"BT\",\n  \"Biota, Aquatic\" = \"BA\",\n  \"Biota, Atmospheric\" = \"BAm\",\n  \"Biota, Other\" = \"BO\"\n)\n\n# Add codes to data ----\ndata_sf &lt;- data_sf |&gt;\n  mutate(\n    SUBCOMP_CODE = subcomp_codes[ENVIRON_COMPARTMENT_SUB],\n    SUBCOMP_CODE = ifelse(is.na(SUBCOMP_CODE), \"?\", SUBCOMP_CODE)\n  )\n\n# Define map colours ----\nmarine_colors &lt;- list(\n  default = \"lightblue\",\n  highlight = \"darkblue\"\n)\n\ncountry_colours &lt;- list(\n  default = \"lightgreen\",\n  highlight = \"darkgreen\"\n)\n\n# Calculate polygon centroids for labels ----\nmarine_centroids &lt;- wgs84_geo$marine_polys |&gt;\n  filter(highlight_name) |&gt;\n  st_centroid()\n\ncountry_centroids &lt;- wgs84_geo$countries |&gt;\n  filter(\n    highlight_name,\n    !name %in% c(\"Greenland\", \"Iceland\", \"Norway\")\n  ) |&gt;\n  st_centroid()\n\n# Create study connection lines ----\nstudy_lines &lt;- data_sf |&gt;\n  st_drop_geometry() |&gt;\n  group_by(REFERENCE_ID) |&gt;\n  filter(n() &gt; 1) |&gt;\n  summarise(\n    coords = list(cbind(LONGITUDE, LATITUDE)),\n    .groups = \"drop\"\n  )\n\n# Convert to linestring sf object ----\nstudy_lines_sf &lt;- study_lines |&gt;\n  rowwise() |&gt;\n  mutate(\n    geometry = list(st_linestring(coords))\n  ) |&gt;\n  ungroup() |&gt;\n  select(-coords) |&gt;\n  st_sf(crs = st_crs(\"WGS84\"))\n\n# Create map ----\nmap &lt;- leaflet() |&gt;\n  addProviderTiles(providers$CartoDB.Positron) |&gt;\n\n  # Add ocean polygons (no popups) ----\n  addPolygons(\n    data = wgs84_geo$marine_polys |&gt; filter(highlight_name),\n    fillColor = ~ ifelse(\n      highlight_name == TRUE,\n      marine_colors[[\"highlight\"]],\n      marine_colors[[\"default\"]]\n    ),\n    fillOpacity = ~ ifelse(highlight_name == TRUE, 0.3, 0),\n    color = \"black\",\n    weight = 1,\n    group = \"Geography\"\n  ) |&gt;\n\n  # Add country polygons (no popups) ----\n  addPolygons(\n    data = wgs84_geo$countries |&gt; filter(highlight_name),\n    fillColor = ~ ifelse(\n      highlight_name == TRUE,\n      country_colours[[\"highlight\"]],\n      country_colours[[\"default\"]]\n    ),\n    fillOpacity = ~ ifelse(highlight_name == TRUE, 0.3, 0),\n    weight = 1,\n    color = \"black\",\n    group = \"Geography\"\n  ) |&gt;\n\n  # Add permanent labels for oceans ----\n  addLabelOnlyMarkers(\n    data = marine_centroids,\n    label = ~name,\n    labelOptions = labelOptions(\n      noHide = TRUE,\n      direction = \"center\",\n      textOnly = TRUE,\n      style = list(\n        \"color\" = \"darkblue\",\n        \"font-weight\" = \"bold\",\n        \"font-size\" = \"14px\",\n        \"text-shadow\" = \"1px 1px 2px white, -1px -1px 2px white\"\n      )\n    ),\n    group = \"Geography\"\n  ) |&gt;\n\n  # Add permanent labels for countries ----\n  addLabelOnlyMarkers(\n    data = country_centroids,\n    label = ~name,\n    labelOptions = labelOptions(\n      noHide = TRUE,\n      direction = \"center\",\n      textOnly = TRUE,\n      style = list(\n        \"color\" = \"darkgreen\",\n        \"font-weight\" = \"bold\",\n        \"font-size\" = \"12px\",\n        \"text-shadow\" = \"1px 1px 2px white, -1px -1px 2px white\"\n      )\n    ),\n    group = \"Geography\"\n  ) |&gt;\n\n  # Add study connection lines ----\n  addPolylines(\n    data = study_lines_sf,\n    color = \"purple\",\n    weight = 2,\n    opacity = 0.5,\n    dashArray = \"5, 5\",\n    label = ~ paste0(\"Study: \", REFERENCE_ID),\n    labelOptions = labelOptions(\n      style = list(\"font-weight\" = \"normal\")\n    ),\n    group = \"Study Connections\"\n  ) |&gt;\n\n  # Add mine tailings markers ----\n  addMarkers(\n    data = mine_tailings_coords(),\n    lng = ~LONGITUDE,\n    lat = ~LATITUDE,\n    icon = list(\n      iconUrl = \"https://upload.wikimedia.org/wikipedia/commons/8/8c/Mining_symbol.svg\",\n      iconSize = c(15, 15)\n    ),\n    popup = ~ paste0(\n      \"&lt;b&gt;Mine:&lt;/b&gt; \",\n      MINE_NAME,\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Location:&lt;/b&gt; \",\n      SITE_NAME,\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Ore Type:&lt;/b&gt; \",\n      ORE_TYPE,\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Status:&lt;/b&gt; \",\n      ifelse(ACTIVE_2013, \"Active (2013)\", \"Terminated\"),\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Details:&lt;/b&gt; \",\n      KEY_DETAILS,\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Coordinate Confidence:&lt;/b&gt; \",\n      CONFIDENCE,\n      \"/5\"\n    ),\n    group = \"Mine Tailings\"\n  ) |&gt; \n\n  # apple markers... for apples\n  addMarkers(\n    data = apple_data,\n    lng = ~x,\n    lat = ~y,\n    icon = list(\n      iconUrl = \"https://www.svgrepo.com/show/42619/apple-fruit.svg\",\n      iconSize = c(15, 15)\n    ),\n    popup = ~ paste0(\n      \"&lt;b&gt;Municipality:&lt;/b&gt; \",\n      name,\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Average Copper Applied:&lt;/b&gt; \",\n      round(avg_copper_kg, 1),\n      \" kg/year\",\n      \"&lt;br&gt;\",\n      \"&lt;b&gt;Period:&lt;/b&gt; 2020-2024\"\n    ),\n    group = \"Apple Production\"\n  ) |&gt; \n\n  # add case study sites\n    addCircles(\n      data = expect_case_studies(),\n    lng = ~lon,\n    lat = ~lat,\n    radius = 100000,  # 100km radius\n    color = \"hotpink\",\n    fillColor = \"hotpink\",\n    fillOpacity = 0.3,\n    opacity = 0.6,\n    weight = 2,\n    popup = ~paste0(\n      \"&lt;strong&gt;\", site_name, \"&lt;/strong&gt;&lt;br/&gt;\",\n      \"&lt;em&gt;Lat: \", lat, \", Lon: \", lon, \"&lt;/em&gt;&lt;br/&gt;&lt;br/&gt;\",\n      summary\n    ),\n    group =       \"Potential Case Studies\"\n\n  )\n\n# Add layers for each main compartment ----\nfor (comp in environ_compartments_vocabulary) {\n  data_subset &lt;- data_sf |&gt;\n    filter(ENVIRON_COMPARTMENT == comp)\n\n  if (nrow(data_subset) &gt; 0) {\n    # Build popup HTML with conditional species info\n    popup_html &lt;- if (comp == \"Biota\") {\n      ~ paste0(\n        \"&lt;b&gt;Reference:&lt;/b&gt; \",\n        REFERENCE_ID,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Site:&lt;/b&gt; \",\n        SITE_CODE,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Date:&lt;/b&gt; \",\n        SAMPLING_DATE,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Compartment:&lt;/b&gt; \",\n        ENVIRON_COMPARTMENT,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Sub-compartment:&lt;/b&gt; \",\n        ENVIRON_COMPARTMENT_SUB,\n        \" (\",\n        SUBCOMP_CODE,\n        \")\",\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Species:&lt;/b&gt; \",\n        SAMPLE_SPECIES,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Measured Value:&lt;/b&gt; \",\n        round(MEASURED_VALUE_STANDARD, 3),\n        \" \",\n        MEASURED_UNIT_STANDARD\n      )\n    } else {\n      ~ paste0(\n        \"&lt;b&gt;Reference:&lt;/b&gt; \",\n        REFERENCE_ID,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Site:&lt;/b&gt; \",\n        SITE_CODE,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Date:&lt;/b&gt; \",\n        SAMPLING_DATE,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Compartment:&lt;/b&gt; \",\n        ENVIRON_COMPARTMENT,\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Sub-compartment:&lt;/b&gt; \",\n        ENVIRON_COMPARTMENT_SUB,\n        \" (\",\n        SUBCOMP_CODE,\n        \")\",\n        \"&lt;br&gt;\",\n        \"&lt;b&gt;Measured Value:&lt;/b&gt; \",\n        round(MEASURED_VALUE_STANDARD, 3),\n        \" \",\n        MEASURED_UNIT_STANDARD\n      )\n    }\n\n    map &lt;- map |&gt;\n      addCircleMarkers(\n        data = data_subset,\n        fillColor = ~ value_pal(MEASURED_VALUE_STANDARD),\n        color = compartment_pal(comp),\n        weight = 2,\n        fillOpacity = 0.7,\n        radius = 6,\n        label = ~SUBCOMP_CODE,\n        labelOptions = labelOptions(\n          noHide = TRUE,\n          direction = \"center\",\n          textOnly = TRUE,\n          style = list(\n            \"color\" = compartment_pal(comp),\n            \"font-weight\" = \"normal\",\n            \"font-size\" = \"8px\"\n          )\n        ),\n        popup = popup_html,\n        group = \"Samples\"\n      )\n  }\n}\n\n# Add site labels as separate toggleable layer ----\nmap &lt;- map |&gt;\n  addLabelOnlyMarkers(\n    data = data_sf,\n    label = ~SITE_CODE,\n    labelOptions = labelOptions(\n      noHide = FALSE,\n      direction = \"top\",\n      textOnly = TRUE,\n      style = list(\n        \"color\" = \"black\",\n        \"font-size\" = \"9px\",\n        \"background\" = \"rgba(255, 255, 255, 0.7)\",\n        \"padding\" = \"2px\"\n      )\n    ),\n    group = \"Site Labels\"\n  ) |&gt;\n\n  # Add layer controls ----\n  addLayersControl(\n    baseGroups = character(0),\n    overlayGroups = c(\n      \"Geography\",\n      \"Study Connections\",\n      \"Mine Tailings\",\n      \"Apple Production\",\n      \"Samples\",\n      \"Site Labels\",\n      \"Potential Case Studies\"\n    ),\n    options = layersControlOptions(collapsed = FALSE)\n  ) |&gt;\n\n  # Add legends ----\n  addLegend(\n    position = \"bottomright\",\n    pal = compartment_pal,\n    values = environ_compartments_vocabulary,\n    title = \"Compartment&lt;br&gt;(border colour)\",\n    opacity = 1\n  ) |&gt;\n  addLegend(\n    position = \"bottomleft\",\n    pal = value_pal,\n    values = data_sf$MEASURED_VALUE_STANDARD,\n    title = \"Measured Value&lt;br&gt;(fill colour)\",\n    opacity = 0.8,\n    labFormat = labelFormat(digits = 1)\n  )\n\n# Display map ----\nbslib::card(full_screen = TRUE, map, style = \"text-align: left; z-index: 999999;\") # yes, of course, that makes perfect sense\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3"
  },
  {
    "objectID": "output/visualisation_quarto.html#copper-concentrations-by-environmental-compartment",
    "href": "output/visualisation_quarto.html#copper-concentrations-by-environmental-compartment",
    "title": "EXPECT Copper AEP",
    "section": "Copper Concentrations by Environmental Compartment",
    "text": "Copper Concentrations by Environmental Compartment\nGet a basic overview of the orders of magnitude for different sub-compartments (Figure 4), so we can plot them on scales that make sense. Note that I haven’t included uncertainty or sample sizes.\n\n\nCode\nliterature_merged_data |&gt; \n  filter(!is.na(MEASURED_UNIT_STANDARD)) |&gt; \n  ggplot(aes(x = MEASURED_VALUE_STANDARD, y = ENVIRON_COMPARTMENT_SUB, color = ENVIRON_COMPARTMENT_SUB)) +\n  geom_point() +\n  facet_nested(rows = vars(ENVIRON_COMPARTMENT, MEASURED_UNIT_STANDARD), \n  scales = \"free_y\", \n  space = \"free_y\", \n  nest_line = element_line()\n  ) +\n  theme_minimal() +\n    scale_color_manual(\n    values = compartment_colours,\n    breaks = names(compartment_colours)\n  ) +\n    theme(legend.position = \"none\") +\n    labs(x = \"\", y = \"\")\n\n\nWarning: Removed 18 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\nFigure 4\n\n\n\n\n\nThe following sections present copper concentration distributions for each major environmental compartment. Plots are based on reported means uncertainty bounds (SD, range, 95% CI, etc.) and overlaid with relevant regulatory thresholds where available.\n\nAquatic Compartment\n\nFreshwater\nFigure 5 shows we have a fair amount of data for water. It’s not strictly useful to include saltwater, freshwater and inbetween on here, so I think it makes sense to split it - but it won’t make a massive difference to the final product.\nSome of these units raise some big questions. Why is brackish/transitional using dry? And why are there some aquatic biota using mg/L?\n\n\nCode\n# Calculate sample sizes\nsample_sizes_water &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |&gt;\n  slice(1)\n\n# Create plot\nliterature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1, vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps, THRESHOLD_TYPE == \"Classification boundary\")\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |&gt;\n        cross_join(first_facet)\n    },\n    aes(x = THRESHOLD_VALUE, y = Inf, label = THRESHOLD_CLASS, color = THRESHOLD_CLASS),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n      coord_cartesian(\n    xlim = range(\n      literature_merged_data$MEASURED_OR_IMPUTED_VALUE_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB == \"Freshwater\"\n      ],\n      na.rm = TRUE\n    ) |&gt; round(),\n    clip = \"off\"  # allows threshold labels to extend beyond plot area if needed\n  ) \n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_vline()`).\n\n\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_text()`).\n\n\n\n\n\n\n\n\nFigure 5: Copper concentrations in water column samples by reference\n\n\n\n\n\n\n\nSalt and Transitional Water\nFigure 6\n\n\nCode\n# Calculate sample sizes\nchosen_compartments &lt;- c(\"Marine/Salt Water\", \"Brackish/Transitional Water\")\n\nsample_sizes_water &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |&gt;\n  slice(1)\n\n# Create plot\nliterature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1, vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps, THRESHOLD_TYPE == \"Classification boundary\")\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |&gt;\n        cross_join(first_facet)\n    },\n    aes(x = THRESHOLD_VALUE, y = Inf, label = THRESHOLD_CLASS, color = THRESHOLD_CLASS),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n      coord_cartesian(\n    xlim = range(\n      literature_merged_data$MEASURED_OR_IMPUTED_VALUE_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |&gt; round(),\n    clip = \"off\"  # allows threshold labels to extend beyond plot area if needed\n  ) \n\n\n\n\n\n\n\n\nFigure 6: Copper concentrations in water column samples by reference\n\n\n\n\n\n\n\nAquatic Sediment\nFigure 7\n\n\nCode\n# Calculate sample sizes\nchosen_compartments &lt;- c(\"Aquatic Sediment\")\n\nsample_sizes_water &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |&gt;\n  slice(1)\n\n# Create plot\nliterature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1, vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps, THRESHOLD_TYPE == \"Classification boundary\")\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |&gt;\n        cross_join(first_facet)\n    },\n    aes(x = THRESHOLD_VALUE, y = Inf, label = THRESHOLD_CLASS, color = THRESHOLD_CLASS),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n      coord_cartesian(\n    xlim = range(\n      literature_merged_data$MEASURED_OR_IMPUTED_VALUE_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |&gt; round(),\n    clip = \"off\"  # allows threshold labels to extend beyond plot area if needed\n  ) \n\n\n\n\n\n\n\n\nFigure 7: Copper concentrations in aquatic sediment samples by reference\n\n\n\n\n\n\n\n\nTerrestrial Compartment\nCurrently, data on copper in the terrestrial compartment is limited to one study (Figure 8).\n\n\nCode\n# Calculate sample sizes\nchosen_compartments &lt;- c(\"Soil O Horizon (Organic)\")\n\nsample_sizes_water &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet &lt;- literature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |&gt;\n  slice(1)\n\n# Create plot\nliterature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |&gt;\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1, vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps, THRESHOLD_TYPE == \"Classification boundary\")\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps &lt;- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |&gt;\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |&gt;\n        cross_join(first_facet)\n    },\n    aes(x = THRESHOLD_VALUE, y = Inf, label = THRESHOLD_CLASS, color = THRESHOLD_CLASS),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n      coord_cartesian(\n    xlim = range(\n      literature_merged_data$MEASURED_OR_IMPUTED_VALUE_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |&gt; round(),\n    clip = \"off\"  # allows threshold labels to extend beyond plot area if needed\n  ) \n\n\n\n\n\n\n\n\nFigure 8: Copper concentrations in terrestrial samples by reference\n\n\n\n\n\n\n\nBiota Compartment\n\nAquatic Biota\nFigure 9 presents copper body burdens across different species groups. Note: There appear to be issues with the distribution calculations for biota that require further investigation.\n\n\nCode\nliterature_merged_data |&gt;\n  filter(\n    ENVIRON_COMPARTMENT == \"Biota\"\n  ) |&gt;\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = SAMPLE_SPECIES,\n    colour = SPECIES_GROUP\n  )) +\n  geom_pointrange(aes(\n    xmin = UNCERTAINTY_UPPER_STANDARD,\n    xmax = UNCERTAINTY_UPPER_STANDARD\n  )) +\n  facet_wrap(\n    facet = vars(OCEAN_COUNTRY),\n    ncol = 1,\n    scales = \"free_y\",\n    space = \"free_y\"\n  )\n\n\n\n\n\n\n\n\nFigure 9: Density distributions of copper concentrations in biota, separated by species group. Copper is an essential micronutrient, so baseline concentrations vary widely among taxa. High concentrations may indicate either regulatory adaptation or toxic exposure. Note: Distribution calculations require verification."
  },
  {
    "objectID": "output/visualisation_quarto.html#temporal-trends",
    "href": "output/visualisation_quarto.html#temporal-trends",
    "title": "EXPECT Copper AEP",
    "section": "Temporal Trends",
    "text": "Temporal Trends\n\nAbiotic Compartments\nFigure 10 examines temporal trends in copper concentrations across abiotic environmental compartments. The current dataset has limited temporal coverage, but these trends may become more apparent as additional data from monitoring databases (e.g., Vannmiljø) are incorporated.\n\n\nCode\np &lt;- literature_merged_data |&gt;\n  filter(\n    !is.na(MEASURED_UNIT_STANDARD),\n    UNCERTAINTY_TYPE == \"Standard Deviation\",\n    ENVIRON_COMPARTMENT != \"Biota\"\n  ) |&gt;\n  group_by(ENVIRON_COMPARTMENT_SUB, SAMPLE_SPECIES) |&gt;\n  ggplot(aes(\n    x = YEAR,\n    y = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    color = ENVIRON_COMPARTMENT_SUB\n  )) +\n  geom_point() +\n  geom_errorbar(\n    aes(ymin = UNCERTAINTY_LOWER_STANDARD, ymax = UNCERTAINTY_UPPER_STANDARD),\n    width = .2,\n  ) +\n  facet_wrap(\n    facets = vars(ENVIRON_COMPARTMENT_SUB),\n    ncol = 1,\n    scales = \"free_y\"\n  ) +\n  labs(\n    x = \"Year\",\n    y = \"Copper Concentration (standardised units)\",\n    color = \"Sub-compartment\"\n  ) +\n  theme_minimal()\n\nplotly::ggplotly(p)\n\n\n\n\n\n\n\n\nFigure 10: Temporal trends in copper concentrations across abiotic environmental sub-compartments. Points represent mean values with error bars showing standard deviations. Limited temporal coverage currently restricts trend interpretation, but patterns may emerge with additional historical monitoring data.\n\n\n\n\n\n\nBiota\nFigure 11 shows temporal patterns in biotic copper concentrations across species groups. Interpretation should consider both temporal changes in exposure and potential differences in species composition across sampling years.\n\n\nCode\np &lt;- literature_merged_data |&gt;\n  filter(\n    !is.na(MEASURED_UNIT_STANDARD),\n    ENVIRON_COMPARTMENT == \"Biota\"\n  ) |&gt;\n  ggplot(aes(\n    x = YEAR,\n    y = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    color = SAMPLE_SPECIES\n  )) +\n  geom_point() +\n  geom_errorbar(\n    aes(ymin = UNCERTAINTY_LOWER_STANDARD, ymax = UNCERTAINTY_UPPER_STANDARD),\n    width = .2,\n  ) +\n  facet_wrap(\n    facets = vars(SPECIES_GROUP),\n    ncol = 1,\n    scales = \"free_y\"\n  ) +\n  labs(\n    x = \"Year\",\n    y = \"Copper Concentration (standardised units)\",\n    color = \"Species\"\n  ) +\n  theme_minimal()\n\nplotly::ggplotly(p)\n\n\n\n\n\n\n\n\nFigure 11: Temporal trends in copper body burdens across different species groups. Points are coloured by species to help distinguish measurement series. Error bars represent reported uncertainty ranges. Vertical facets separate species groups to account for baseline differences in copper accumulation patterns."
  },
  {
    "objectID": "output/visualisation_quarto.html#appendix-1-copper-sources-data",
    "href": "output/visualisation_quarto.html#appendix-1-copper-sources-data",
    "title": "EXPECT Copper AEP",
    "section": "Appendix 1: Copper Sources Data",
    "text": "Appendix 1: Copper Sources Data\n\nSubmarine Tailing Disposal in/off Norway\nNote: STD locations (named) extracted from Kvassnes & Iversen 2013. Coordinates estimated by LLM, confidence self-reported by LLM.\n\n\nCode\nmine_tailings_coords() |&gt; DT::datatable()\n\n\n\n\nTable 2\n\n\n\n\n\n\n\n\n\n\n\n\nApple Production Areas in Norway\nAccording to https://static02.nmbu.no/mina/studier/moppgaver/2018-Paulsen.pdf, 7 municipalities represent the main fruit districts in Norway. We also have sales of copper oxide for 2020-24 from https://mattilsynet-xp7prod.enonic.cloud/_/attachment/inline/8311cd70-8877-4712-98cc-f7bc1dba46ac:0f491609e72f1d5f0dca5ad1030a4b979e8b4695/Omsetningsstatistikk%20for%20plantevernmidler%202020%20-%202024%20med%20uthevinger.pdf (table 2a, p4, thanks to Roger Holten).\n\n\nCode\nnumber_of_sites &lt;- nrow(municipality_centroids())\nsales_data_split &lt;- copper_oxide_sales() |&gt; mutate(amount_kg = amount_kg / number_of_sites,\naverage_kg = average_kg / number_of_sites)\n\ncross_join(municipality_centroids(), sales_data_split) |&gt; \n   DT::datatable()\n\n\n\n\nTable 3\n\n\n\n\n\n\n\n\n\n\nAlthough not explicitly stated, we assume that:\n\nCopper products used as fungicides are exclusively applied in these areas and enter the environment via soil and freshwater\nApple farmers use the arthimetic mean of sold copper oxide for 2020 - 2024 every year. all applied copper oxide enters the environment.\nThe total used copper is split equally between the “main fruit districts” named in Paulsen (2018).\n\n\n\nManufacturing Emissions of Copper in Norway\nTaken from https://www.norskeutslipp.no/no/Komponenter/Utslipp/Kobber/?ComponentType=utslipp&ComponentPageID=73&SectorID=600, which includes self-reported copper emissions by land-based Norwegian industries for 1985-2024. Date is very spotty and incomplete, but it allows us to highlight fylke with higher emissions. Map to follow.\nWe assume:\n\nReported concentrations are fully correct\nEverything ends up in the environment.\n\n\n\nCode\nsource(\"temp_R/scratchpad_norske_utslippe.R\")\n\ntop_municipalities_plot\n\n\n\n\n\n\n\n\nFigure 12"
  },
  {
    "objectID": "output/reprex.html",
    "href": "output/reprex.html",
    "title": "Leaflet Sidebar Issue Reprex",
    "section": "",
    "text": "library(leaflet)\nlibrary(bslib)\n\n# Create a simple leaflet map\nmap &lt;- leaflet() |&gt;\n  addProviderTiles(providers$CartoDB.Positron) |&gt;\n  addCircleMarkers(\n    lng = c(10.7522, 5.7339),\n    lat = c(59.9139, 58.9700),\n    popup = c(\"Oslo\", \"Stavanger\"),\n    radius = 10,\n    fillOpacity = 0.7\n  )\n\n# Wrap in bslib card with full_screen option\nbslib::card(\n  full_screen = TRUE, \n  map, \n  style = \"text-align: left; z-index: 999999;\"\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nSection\nLorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum\n\n\nSection\nLorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum Lorem ipsum\n\n\nSection\n\n\nSection\n\n\nSection\n\n\nSection\n\n\nSection"
  }
]