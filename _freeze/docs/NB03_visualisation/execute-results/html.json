{
  "hash": "532454723aad00434fbefea4b8af2bc9",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Notebook 03 - Exposure Visualisation\"\nauthor: \"Sam Welch\"\ndate: \"2025.11.25\"\nlightbox: true\nformat:\n  html:\n    grid:\n      body-width: 1500px\n      sidebar-width: 0px\n    page-layout: full\n    code-fold: true\n    max-width: 4500px\n    fig-format: png\n    toc: true\n---\n\n<!-- include-in-header:\n  - text\n      <style>\n      /* \"Hide\" TOC sidebar when card is in full-screen mode */\n      .bslib-card[data-full-screen=\"true\"] ~ #quarto-margin-sidebar,\n      body:has(.bslib-card[data-full-screen=\"true\"]) #quarto-margin-sidebar {\n        z-index: 0 !important;\n      }\n      </style> -->\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: targets-setup\n#| warning: false\n#| output: false\n#| echo: false\n\nsuppressPackageStartupMessages({\n  library(STOPeData)\n  library(DT)\n  library(dplyr)\n  library(tidyr)\n  library(ggplot2)\n  library(forcats)\n  library(viridis)\n  library(stringr)\n  library(ggridges)\n  library(ggh4x)\n  library(tidygraph)\n  library(ggraph)\n  library(ggiraph)\n  library(leaflet)\n  library(sf)\n  library(shiny)\n  library(dplyr)\n  library(bslib)\n  library(ggtext)\n  library(data.table)\n  library(eDataDRF)\n  library(here)\n  library(targets)\n})\n\nhere::i_am(\"./README.md\") # relative to docs folder\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nhere() starts at C:/Users/SAW/Local Documents/EXPECT AEP/EXPECT_AEP_R_Project\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: targets-setup\n#| warning: false\n#| output: false\n#| echo: false\n\ntar_config_set(store = here(\"_targets\"))\ndevtools::load_all(path = here::here())\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nℹ Loading EXPECT_AEP_R_Project\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: targets-setup\n#| warning: false\n#| output: false\n#| echo: false\n\n# cat(\"here() resolves to:\", here::here(), \"\\n\", file = stderr())\n# cat(\"Working directory:\", getwd(), \"\\n\", file = stderr())\n\n# here::i_am(\"./README.md\") # relative to manuscript folder\n# source(here::here(\"_targets.R\"))\n# devtools::load_all(path = here::here())\n\n# cat(\"here() resolves to:\", here::here(), \"\\n\", file = stderr())\n# cat(\"Working directory:\", getwd(), \"\\n\", file = stderr())\n# tar_make(script = targets::tar_config_get(\"script\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: load-data\n# load in any data we need from the targets workflow\nliterature_merged_data <- tar_read(load_literature_pqt)\nliterature_reference_data <- tar_read(reference_data)\nliterature_campaign_data <- tar_read(campaign_data)\nliterature_sites_data <- tar_read(sites_data)\nliterature_qc <- tar_read(data_quality_report)\nwgs84_geo <- tar_read(wgs84_geography)\n\nspecies_names <- eDataDRF::species_names_vocabulary()\nspecies_lookup <- species_names |>\n  with(setNames(SPECIES_COMMON_NAME, SPECIES_NAME))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| label: themes-and-helpers\n\ncopper_toxicity_thresholds <- tar_read(copper_toxicity_thresholds)\n# Define threshold colors based on the report ----\nthreshold_colours <- c(\n  \"Background (I)\" = \"#0070C0\", # Blue\n  \"Good (II)\" = \"#00B050\", # Green\n  \"Moderate (III)\" = \"#FFC000\", # Yellow\n  \"Poor (IV)\" = \"#FF6600\", # Orange\n  \"Very Poor (V)\" = \"#FF0000\" # Red\n)\n\ncompartment_colours <- c(\n  # Aquatic ----\n  \"Freshwater\" = \"#4A90E2\", # clear blue\n  \"Marine/Salt Water\" = \"#1E5A8E\", # deep ocean blue\n  \"Brackish/Transitional Water\" = \"#6BA5C8\", # mid-blue (between fresh/marine)\n  \"Groundwater\" = \"#2C5F7B\", # darker, subdued blue\n  \"Wastewater\" = \"#8B7355\", # murky brown\n  \"Liquid Growth Medium\" = \"#9FD8CB\", # pale greenish-blue\n  \"Rainwater\" = \"#B3D9FF\", # light sky blue\n  \"Stormwater\" = \"#607D8B\", # grey-blue\n  \"Leachate\" = \"#6B5344\", # dark muddy brown\n  \"Aquatic Sediment\" = \"#EBCF1B\", # your existing yellow\n  \"Porewater\" = \"#7FA0B8\", # muted blue-grey\n  \"Sludge\" = \"#67AB33\", # your existing green\n\n  # Atmospheric ----\n  \"Indoor Air\" = \"#E8F4F8\", # very pale blue-grey\n  \"Outdoor Air\" = \"#87CEEB\", # sky blue\n\n  # Terrestrial ----\n  \"Terrestrial Biological Residue\" = \"#8B6F47\", # organic brown\n  \"Soil H Horizon (Peat)\" = \"#3E2723\", # very dark brown\n  \"Soil O Horizon (Organic)\" = \"#5D4037\", # dark organic brown\n  \"Soil A Horizon (Topsoil)\" = \"#795548\", # medium brown\n  \"Soil E Horizon (Mineral)\" = \"#A1887F\", # light greyish-brown\n  \"Soil S Horizon (Mineral)\" = \"#BCAAA4\", # pale brown-grey\n  \"Soil C Horizon (Parent Material)\" = \"#D7CCC8\", # very pale brown\n  \"Soil R Horizon (Bedrock)\" = \"#9E9E9E\", # grey\n\n  # Biota ----\n  \"Biota, Terrestrial\" = \"#558B2F\", # forest green\n  \"Biota, Aquatic\" = \"#00695C\", # teal\n  \"Biota, Atmospheric\" = \"#B39DDB\", # light purple (birds/insects)\n  \"Biota, Other\" = \"#9C27B0\" # distinct purple\n)\n\n# Helper function for sample sizes\ncalculate_sample_sizes <- function(data) {\n  data |>\n    group_by(\n      REFERENCE_ID,\n      OCEAN_COUNTRY,\n      SITE_GEOGRAPHIC_FEATURE,\n      ENVIRON_COMPARTMENT_SUB\n    ) |>\n    summarise(total_n = sum(MEASURED_N, na.rm = TRUE), .groups = \"drop\")\n}\n\n# Create sub-compartment letter codes ----\nsubcomp_codes <- c(\n  # Aquatic\n  \"Freshwater\" = \"F\",\n  \"Marine/Salt Water\" = \"M\",\n  \"Brackish/Transitional Water\" = \"B\",\n  \"Groundwater\" = \"G\",\n  \"Wastewater\" = \"WW\",\n  \"Liquid Growth Medium\" = \"LGM\",\n  \"Rainwater\" = \"R\",\n  \"Stormwater\" = \"SW\",\n  \"Leachate\" = \"L\",\n  \"Aquatic Sediment\" = \"AS\",\n  \"Porewater\" = \"P\",\n  \"Sludge\" = \"Sl\",\n  # Atmospheric\n  \"Indoor Air\" = \"IA\",\n  \"Outdoor Air\" = \"OA\",\n  # Terrestrial\n  \"Terrestrial Biological Residue\" = \"TBR\",\n  \"Soil H Horizon (Peat)\" = \"H\",\n  \"Soil O Horizon (Organic)\" = \"O\",\n  \"Soil A Horizon (Topsoil)\" = \"A\",\n  \"Soil E Horizon (Mineral)\" = \"E\",\n  \"Soil S Horizon (Mineral)\" = \"S\",\n  \"Soil C Horizon (Parent Material)\" = \"C\",\n  \"Soil R Horizon (Bedrock)\" = \"R\",\n  # Biota\n  \"Biota, Terrestrial\" = \"BT\",\n  \"Biota, Aquatic\" = \"BA\",\n  \"Biota, Atmospheric\" = \"BAm\",\n  \"Biota, Other\" = \"BO\"\n)\n```\n:::\n\n\n## Dataset Overview\n\n### To Do\n\n-   [ ] Add probable contamination sources to each paper\n-   [ ] Make sure we handle missing characters properly\n-   [ ] Reach out to Dag or Jens to ask if MD have any copper emissions data\n-   [ ] Talk to Marianne from reference group (or anyone else on the reference group)\n-   [ ] Get more data in\n-   [ ] Make network diagram visualise uncertainty, etc.\n-   [ ] Functional and risk assessment trophic levels may not be perfectly aligned\n    -   [ ] might be better off using ERA grouping - talk to Li about it\n-   [ ] Fix icon colouration in map\n-   [ ] Flag papers with transfer data (again)\n-   [ ] Add CREED stuff\n-   [ ] Add missing species names\n-   [ ] Get some salinity & DOC (or at least water darkness) datasets\n-   [ ] Find a good way to add sea ice to map\n-   [ ] Find a good aquaculture zone and mining waste zone and characterise the sources well\n\n## Literature Summary\n\n@tbl-paper-summaries provides a comprehensive summary of all papers included in this analysis, showing the number of measurements extracted from each study and their associated sampling campaigns.\n\n\n::: {#tbl-paper-summaries .cell .hidden tbl-cap='Summary of analysed papers showing publication details, associated campaigns, and number of copper measurements extracted from each study.'}\n\n```{.r .cell-code .hidden}\n#| label: tbl-paper-summaries\n#| tbl-cap: \"Summary of analysed papers showing publication details, associated campaigns, and number of copper measurements extracted from each study.\"\n#| warning: false\n#| include: false\nliterature_merged_data |>\n  dplyr::left_join(literature_reference_data) |>\n  dplyr::left_join(\n    literature_campaign_data |> select(CAMPAIGN_NAME_SHORT, CAMPAIGN_COMMENT)\n  ) |>\n  dplyr::group_by(\n    TITLE,\n    YEAR,\n    AUTHOR,\n    CAMPAIGN_COMMENT\n  ) |>\n  dplyr::reframe(SUM_N = sum(MEASURED_N)) |>\n  datatable(options = list(pageLength = 5, lengthMenu = c(5, 10, 15, 20)))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nJoining with `by = join_by(REFERENCE_ID, YEAR, TITLE, DATA_SOURCE)`\nJoining with `by = join_by(CAMPAIGN_NAME_SHORT, CAMPAIGN_COMMENT)`\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-4de81e0a58a3c854c082\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-4de81e0a58a3c854c082\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\"],[\"A study of metal concentrations and metallothionein binding capacity in liver, kidney and brain tissues of three Arctic seal species\",\"An integrative biological effects assessment of a mine discharge into a Norwegian fjord using field transplanted mussels\",\"Benthic community status and mobilization of Ni, Cu and Co at abandoned sea deposits for mine tailings in SW Norway\",\"Biogeochemical impact of historical submarine mine tailings on benthic ecosystems in the Repparfjord (Northern Norway)\",\"Content and distribution of trace metals in surface sediments from the northern Bering Sea, Chukchi Sea and adjacent Arctic areas\",\"Distribution pattern of mercury in northern Barents Sea and Eurasian Basin surface sediment\",\"Effects of biotransport and hydro-meteorological conditions on transport of trace elements in the Scott River (Bellsund, Spitsbergen)\",\"Effects of industrial processing on essential elements and regulated and emerging contaminant levels in seafood\",\"Environmental impact of an acid-forming alum shale waste rock legacy site in Norway\",\"Green sea urchins (Strongylocentrotus droebachiensis) as potential biomonitors of metal pollution near a former lead-zinc mine in West Greenland\",\"Heavy Metals in Zooplankton and Decapod Crustaceans from the Barents Sea\",\"Heavy metals of inshore Benthic invertebrates from the Barents Sea\",\"Impacts of climate change on metal leaching and partitioning for submarine mine tailings disposal\",\"Lability of toxic elements in Submarine Tailings Disposal: The relationship between metal fractionation and metal uptake by sandworms (Alitta virens)\",\"Levels of Polychlorinated Biphenyls, Organochlorine Pesticides, Mercury, Cadmium, Copper, Selenium, Arsenic, and Zinc in the Harbour Seal, Phoca vitulina, in Norwegian Waters\",\"Metal accumulation and metallothionein in brown trout, Salmo trutta, from two Norwegian rivers differently contaminated with Cd, Cu and Zn\",\"Metallothioneins and trace metals in the dogwhelk Nucella lapillus (L.) collected from Icelandic coasts\",\"Monitoring and modelling of influent patterns, phase distribution and removal of 20 elements in two primary wastewater treatment plants in Norway\",\"Spatial and temporal trends of selected trace elements in liver tissue from polar bears (Ursus maritimus) from Alaska, Canada and Greenland\",\"Speciation of heavy metals in marine sediments vs their bioaccumulation by mussels\",\"Structure of Sediment-Associated Microbial Communities along a Heavy-Metal Contamination Gradient in the Marine Environment\",\"Temporal isolation between two strongly differentiated stocks of the Greenland halibut (Reinhardtius hippoglossoides Walbaum, 1792) from the Western Barents Sea\",\"Toxic and essential elements changed in black-legged kittiwakes (Rissa tridactyla) during their stay in an Arctic breeding area\",\"Toxic and essential elements in seafood from Mausund, Norway\",\"Trace element levels in harp seal (Pagophilus groenlandicus) and hooded seal (Cystophora cristata) from the Greenland Sea. A multivariate approach\",\"Trace metals in field samples of zooplankton from the Fram Strait and the Greenland Sea\",\"Trace metals in skeletal calcite of echinoderms from the Barents Sea\",\"Transport and sedimentation of Cu in a microtidal estuary, SE Norway\",\"Trends and potential human health risk of trace elements accumulated in transplanted blue mussels during restoration activities of Flekkefjord fjord (Southern Norway)\",\"Vannmiljø Database - Copper and Copper Pyrithione Data\",null],[2009,2018,2019,2024,2011,2022,2021,2017,2025,2019,2006,2003,2022,2019,1990,2001,2005,2020,2011,1999,2005,2021,2015,2018,2000,1997,2024,2002,2022,2025,null],[\"Sonne, Christian; Aspholm, Ole; Dietz, Rune; Andersen, Steen; Berntssen, Marc H.G.; Hylland, Ketil\",\"Brooks, S.J.; Escudero-Oñate, C.; Gomes, T.; Ferrando-Climent, L.\",\"Schaanning, Morten Thorne; Trannum, Hilde Cecilie; Øxnevad, Sigurd; Ndungu, Kuria\",\"Hoff, Marie; Argentino, Claudio; Huljek, Laura; Fiket, Zeljka; Mun, Yulia; Barrenechea Angeles, Ines; Strmic Palinkas, Sabina; Panieri, Giuliana\",\"Cai, M.H.; Lin, J.; Hong, Q.Q.; Wang, Y.; Cai, M.G.\",\"Kohler, Stephen G.; Kull, Laura M.; Heimbürger-Boavida, Lars-Eric; Ricardo de Freitas, Thaise; Sanchez, Nicolas; Ndungu, Kuria; Ardelan, Murat V.\",\"Lehmann-Konera, Sara; Kociuba, Waldemar; Chmiel, Stanisław; Franczak, Łukasz; Polkowska, Żaneta\",\"Rasmussen, Rie Romme; Søndergaard, Annette Bøge; Bøknæs, Niels; Cederberg, Tommy Licht; Sloth, Jens Jørgen; Granby, Kit\",\"Pelkonen, Mila K.; Reinoso-Maset, Estela; Law, Gareth T. W.; Lind, Ole Christian; Skipperud, Lindis\",\"Søndergaard, Jens; Hansson, Sophia V.; Mosbech, Anders; Bach, Lis\",\"Zauke, G.-P.; Schmalenbach, I.\",\"Zauke, G.-P.; Clason, B.; Savinov, V.M.; Savinova, T.\",\"Pedersen, Kristine B.; Lejon, Tore; Jensen, Pernille E.; Ottosen, Lisbeth M.; Frantzen, Marianne; Evenset, Anita\",\"Simonsen, Anne Mette T.; Pedersen, Kristine B.; Jensen, Pernille E.; Elberling, Bo; Bach, Lis\",\"Skaare, Janneche Utne; Markussen, Nina Hedlund; Norheim, Gunnar; Haugen, Signe; Holt, Gunnar\",\"Olsvik, Pal A.; Gundersen, Pal; Andersen, Rolf A.; Zachariassen, Karl E.\",\"Leung, Kenneth M.Y.; Dewhurst, Rachel E.; Halldórsson, Halldór; Svavarsson, Jörundur\",\"Farkas, Julia; Polesel, Fabio; Kjos, Marianne; Carvalho, Patricia Almeida; Ciesielski, Tomasz; Flores-Alsina, Xavier; Hansen, Steffen Foss; Booth, Andy M.\",\"Routti, Heli; Letcher, Robert J.; Born, Erik W.; Branigan, Marsha; Dietz, Rune; Evans, Thomas J.; Fisk, Aaron T.; Peacock, Elizabeth; Sonne, Christian\",\"Pempkowiak, J.; Sikora, A.; Biernacka, E.\",\"Gillan, David C.; Danis, Bruno; Pernet, Philippe; Joly, Guillemette; Dubois, Philippe\",\"Wojtasik, Barbara; Kijewska, Agnieszka; Mioduchowska, Monika; Mikuła, Barbara; Sell, Jerzy\",\"Øverjordet, Ida Beathe; Kongsrud, Magnus Brunvoll; Gabrielsen, Geir Wing; Berg, Torunn; Ruus, Anders; Evenset, Anita; Borgå, Katrine; Christensen, Guttorm; Jenssen, Bjørn Munro\",\"Ervik, Hilde; Finne, Tor Erik; Jenssen, Bjørn Munro\",\"Julshamn, K.; Grahl-Nielsen, O.\",\"Ritterhoff, Jürgen; Zauke, Gerd-Peter\",\"Iglikowska, Anna; Piwoni-Piorewicz, Anna; Cieślik, Bartłomiej Michał; Żyłan, Dominika; Waszczuk, Patryk; Kuklinski, Piotr\",\"Helland, Aud; Bakke, Torgeir\",\"Parolini, Marco; Panseri, Sara; Håland Gaeta, Federico; Rossi, Luciana; Dell'Anno, Matteo; Ceriani, Federica; De Felice, Beatrice; Rafoss, Trond; Arioli, Francesco; Pilu, Salvatore; Chiesa, Luca Maria\",\"Miljødirektoratet\",null],[\"Pilot study to determine whether background levels of metals in Arctic seal species were related with early biological signs of toxic exposure measured by MT concentrations\",\"Field transplanted mussels used to assess biological effects of mine discharge into Frænfjord. Mussels deployed at known distances from discharge outlet for 8 weeks.\",\"Field sampling from 17-18.11.2015. Includes both grab sampling for macrofauna and box-core sampling for geochemical investigations. Samples transferred to sublittoral, benthic mesocosm at Solbergstrand by the Oslofjord for further analysis.\",\"Multidisciplinary research expedition using RV Helmer Hanssen to examine metal stability and past/current status of foraminiferal community in Repparfjord, Northern Norway. Study coupled pore water chemistry analysis with foraminiferal analysis from sediment cores. Copper concentration data reported for sediment core porewater in SI 2.\",null,\"Samples collected during five cruises on R/V Kronprins Haakon as part of The Nansen Legacy project (RCN#276730) and northeastern Barents Sea samples collected on R/V Dalniye Zelentsy in October and November 2019\",\"Study of 25 trace elements from 84 surface water samples at two river sites, assessing relations to water discharge, precipitation, pH and DOC\",\"Study of industrial processing effects on essential elements and contaminant levels in prawns, Greenland halibut and Atlantic salmon. Raw prawns caught in different seasons and processed into cooked and peeled forms. Fish samples underwent cold smoking processing.\",null,\"Study investigated metal accumulation in green sea urchins near the former Black Angel lead-zinc mine in Maarmorilik, West Greenland. Sea urchins were collected along with seaweed, blue mussels, sediment, and seawater for comparison.\",\"Study conducted over multiple cruises: cruise 217 (May/June 2000), cruise 116 (July 1991), and cruise 150 (August 1994) using RV Walther Herwig II and III in the Barents Sea and Norwegian Sea.\",\"Assessment of Cu, Cd, Ni, Pb and Zn in marine inshore benthic invertebrates collected in summer 1994 from three localities at the Barents Sea.\",\"Bench-scale experiments investigating the influence of variables affecting metal mobility and availability (DOC, pH, salinity, temperature, aerated/anoxic conditions, flocculant concentration, suspension) on leaching and partitioning of metals from mine tailings planned for submarine disposal in Repparfjorden, northern Norway. Three week duration experiments with multivariate experimental design.\",\"Study investigated environmental impacts of submarine tailings disposal one year after cessation of iron ore mine Sydvaranger Gruve. Combined analyses of total metal concentrations, metal fractionation patterns, and metal uptake by sandworms exposed to Bøkfjorden sediment.\",\"Study conducted during the morbilli-virus disease outbreak that killed about 1000 harbour seals in Norwegian waters. Samples collected from 82 individuals found dead or dying for determination of organochlorine and heavy metal contents.\",\"Study compared brown trout from two Norwegian rivers differently contaminated with metals - Rugla (Cu-contaminated) and Naustebekken (Cd/Zn-contaminated) at Røros, Central Norway. Fish were captured June-July 1997 and early September 1998. Water samples collected at regular intervals during ice-free season May-October 1997.\",\"Different sizes of dogwhelk Nucella lapillus were collected from eight locations along the southwest and north coasts of Iceland. Growth rates were also estimated in situ. TBT contamination was assessed indirectly based on imposex indices. Approximate [Cu] read from Figure 3.\",null,\"Collaborative study involving multiple institutions across circumpolar Arctic. Samples from native subsistence hunts from ten subpopulations.\",\"Comparative study between Norwegian Sea off Spitsbergen and Baltic Sea off Poland examining metal speciation in sediments vs bioaccumulation by two mussel species. Paper reports fractionation/speciation of copper, but only in poorly scanned graphs; this data has been excluded from extraction.\",\"Study of microbial communities along a heavy-metal contamination gradient in marine sediments of Sørfjord, Norway. Contamination includes cadmium, copper, lead, and zinc from smelter operations for &gt;80 years.\",\"Commercial cruise to study genetic diversity and heavy metal concentrations in Greenland halibut during spawning migration period in Western Barents Sea. Four samples collected from trawls at different depths and locations. Only two trawls analysed for metal content. Individual organism concentrations reported in paper, but summary statistics calculated in paper used here for efficiency's sake.\",\"Field sampling was a part of a large project studying contaminant dynamics in polar areas (IPY-COPOL). Ten adult kittiwakes were sampled each month using a shotgun.\",\"Annual surveys conducted during the period 2012–2015 as part of student research projects at Byåsen Upper Secondary School, Trondheim, with additional sampling by teachers from NTNU postgraduate course in mid-October 2015. Samplings were conducted in the first half of September each year.\",\"Muscle, liver and kidney were sampled from 29 harp seals (6 juveniles, 8 males and 15 females) and 22 hooded seals (2 juveniles, 5 males and 15 females) captured in the Greenland Sea by research scientists from the Marine Research Institute, Bergen in the winter season of 1985.\",\"Cruise ARK IX/Ib of RV 'Polarstern' to the Fram Strait and the Greenland Sea in March and April 1993. Samples collected mainly along transects on 24 stations at 79°N and 75°N. Zooplankton collected with vertically towed bongo net from about 1500 m depth to surface and oblique rectangular midwater trawl (RMT 1 + 8) from 1000 m depth to surface. Both coordinates and and sampling dates are reported with only rough precision.\",\"Echinoderms collected during summer cruise of R/V Johan Hjort at depths ranging from 74 to 309 m using bottom trawl dragged on the sea bottom for 15 min. 84 specimens analyzed representing 17 species and four echinoderm classes.\",\"Study of transport and sedimentation of copper in the Glomma estuary, SE Norway during a period of 90% reduction in industrial Cu input. Traps deployed at four stations for monthly periods during 1990, 1994 and 1995, with additional four stations in 1995.\",\"6-months active biomonitoring using transplanted blue mussels (Mytilus edulis) in five locations within Flekkefjord fjord to monitor trace elements before and during restoration activities. Mussels were transplanted at 5m and 15m depths and sampled at t=0, 30, 135, 166, and 196 days. Some cages were lost due to storms and mortality occurred in some locations.\",\"Copper and copper pyrithione measurements from Vannmiljø database covering all Norwegian municipalities and media types\",null],[20,400,22,42,25,25,75,46,71,93,208,239,11,164,79,64,480,21,317,23,24,43,58,132,153,540,43,48,2050,48384,null]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>TITLE<\\/th>\\n      <th>YEAR<\\/th>\\n      <th>AUTHOR<\\/th>\\n      <th>CAMPAIGN_COMMENT<\\/th>\\n      <th>SUM_N<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"pageLength\":5,\"lengthMenu\":[5,10,15,20],\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,5]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"TITLE\",\"targets\":1},{\"name\":\"YEAR\",\"targets\":2},{\"name\":\"AUTHOR\",\"targets\":3},{\"name\":\"CAMPAIGN_COMMENT\",\"targets\":4},{\"name\":\"SUM_N\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false},\"selection\":{\"mode\":\"multiple\",\"selected\":null,\"target\":\"row\",\"selectable\":null}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n### Compartment Coverage\n\n\n::: {#cell-fig-paper-subcompartments .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-paper-subcompartments\n#| fig-cap: \"Number of environmental sub-compartments sampled per paper. Each bar represents a unique publication, with height indicating the diversity of compartments (e.g., surface water, sediment, soil) analysed within that study.\"\n#| warning: false\n#| fig-width: 10\n#| fig-height: 8\n#| include: false\n\n# Prepare data for plotting ----\nplot_data <- literature_merged_data |>\n  group_by(REFERENCE_ID, ENVIRON_COMPARTMENT_SUB) |>\n  distinct() |>\n  reframe(count = sum(MEASURED_N, na.rm = TRUE)) |>\n  # Join year data for y-axis ordering\n  left_join(\n    literature_merged_data |> distinct(REFERENCE_ID, YEAR),\n    by = \"REFERENCE_ID\"\n  ) |>\n  filter(!is.na(ENVIRON_COMPARTMENT_SUB))\n\n# Calculate text color threshold ----\nthreshold_value <- mean(plot_data$count, na.rm = TRUE)\n\n# Create plot ----\nggplot(\n  plot_data,\n  aes(\n    y = REFERENCE_ID,\n    x = ENVIRON_COMPARTMENT_SUB,\n    fill = count\n  )\n) +\n  geom_tile() +\n  geom_text(aes(\n    label = count,\n    color = if_else(count > threshold_value, \"black\", \"white\")\n  )) +\n  scale_fill_viridis(name = \"Sample Size (n)\") +\n  scale_color_identity() +\n  theme_aep_plots() +\n  theme(\n    axis.text.x = element_text(angle = 90, hjust = 1),\n    axis.title.y = element_blank(),\n    legend.position = \"none\"\n  ) +\n  labs(x = \"Environmental Sub-Compartment\")\n```\n\n::: {.cell-output-display}\n![Number of environmental sub-compartments sampled per paper. Each bar represents a unique publication, with height indicating the diversity of compartments (e.g., surface water, sediment, soil) analysed within that study.](NB03_visualisation_files/figure-html/fig-paper-subcompartments-1.png){#fig-paper-subcompartments}\n:::\n:::\n\n\n### Species Coverage\n\n@fig-paper-species illustrates the taxonomic diversity captured across studies, highlighting which papers focused on biota measurements and the range of species groups investigated.\n\n\n::: {#cell-fig-paper-species .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-paper-species\n#| fig-cap: \"Sample size per species per paper across the dataset.\"\n#| warning: false\n#| fig-width: 16\n#| fig-height: 8\n#| include: false\n\n# add species common names missing from ECOTOX data\nnew_species <- c(\n  \"Phoca vitulina\" = \"Harbor Seal\",\n  \"Calanus finmarchicus\" = \"Copepod\",\n  \"Calanus glacialis\" = \"Arctic Copepod\",\n  \"Calanus hyperboreus\" = \"Copepod\",\n  \"Conchoecia borealis\" = \"Ostracod\",\n  \"Euchaeta barbata\" = \"Copepod\",\n  \"Euchaeta glacialis\" = \"Arctic Copepod\",\n  \"Euchaeta norvegica\" = \"Copepod\",\n  \"Eukrohnia hamata\" = \"Arrow Worm\",\n  \"Hymenodora glacialis\" = \"Arctic Shrimp\",\n  \"Meganyctiphanes norvegica\" = \"Northern Krill\",\n  \"Metridia longa\" = \"Copepod\",\n  \"Themisto abyssorum\" = \"Amphipod\",\n  \"Themisto libellula\" = \"Amphipod\",\n  \"Thysanoessa inermis\" = \"Arctic Krill\",\n  \"Astarte borealis\" = \"Northern Astarte\",\n  \"Mya arenaria\" = \"Soft-shell Clam\",\n  \"Cystophora cristata\" = \"Hooded Seal\",\n  \"Pagophilus groenlandicus\" = \"Harp Seal\",\n  \"Salmo trutta\" = \"Brown Trout\",\n  \"Arenicola marina\" = \"Lugworm\",\n  \"Gammarus oceanicus\" = \"Amphipod\",\n  \"Littorina rudis\" = \"Rough Periwinkle\",\n  \"Mytilus edulis\" = \"Blue Mussel\",\n  \"Nucella lapillus\" = \"Dog Whelk\",\n  \"Phoca groenlandica\" = \"Harp Seal\",\n  \"Ursus maritimus\" = \"Polar Bear\",\n  \"Rissa tridactyla\" = \"Black-legged Kittiwake\",\n  \"Alitta virens\" = \"King Ragworm\",\n  \"Reinhardtius hippoglossoides\" = \"Greenland Halibut\"\n)\n\n# Extend species_lookup\nspecies_lookup <- c(species_lookup, new_species)\n\n# Prepare data for plotting ----\nplot_data <- literature_merged_data |>\n  group_by(REFERENCE_ID, SAMPLE_SPECIES) |>\n  distinct() |>\n  reframe(count = sum(MEASURED_N, na.rm = TRUE), SPECIES_GROUP) |>\n  # Join year data for y-axis ordering\n  left_join(\n    literature_merged_data |> distinct(REFERENCE_ID, YEAR),\n    by = \"REFERENCE_ID\"\n  ) |>\n  filter(!is.na(SAMPLE_SPECIES)) |>\n  distinct()\n\n# Create formatted labels\nplot_data <- plot_data |>\n  mutate(\n    formatted_species = glue::glue(\n      \"**{species_lookup[SAMPLE_SPECIES]}**<br>*({SAMPLE_SPECIES})*\"\n    )\n  )\n\n\n# Calculate text color threshold ----\nthreshold_value <- 2000 # set manually, as the 2050 mussels tend to overwhelm the others\n\n# Create plot ----\n\nggplot(\n  plot_data,\n  aes(\n    y = REFERENCE_ID, # Use the formatted label\n    x = formatted_species,\n    fill = count\n  )\n) +\n  geom_tile() +\n  geom_text(aes(\n    label = count,\n    color = if_else(count > threshold_value, \"black\", \"white\")\n  )) +\n  scale_fill_viridis(name = \"Sample Size (n)\") +\n  scale_color_identity() +\n\n  theme_aep_plots() + # breaks markdown\n  theme(\n    # we have to specify axis.text.x.bottom or it doesn't work with theme_minimal()\n    axis.text.x.bottom = element_markdown(angle = 90, hjust = 1, vjust = 0.5), # Enable markdown rendering\n    axis.title.y = element_blank(),\n    legend.position = \"none\"\n  ) +\n  labs(x = \"Sampled Species\") +\n\n  facet_wrap(\n    facets = vars(SPECIES_GROUP),\n    space = \"free_x\",\n    scales = \"free_x\",\n    nrow = 1\n  )\n```\n\n::: {.cell-output-display}\n![Sample size per species per paper across the dataset.](NB03_visualisation_files/figure-html/fig-paper-species-1.png){#fig-paper-species}\n:::\n:::\n\n\n## Copper Concentrations by Environmental Compartment\n\nGet a basic overview of the orders of magnitude for different sub-compartments (@fig-basic-subcompartments), so we can plot them on scales that make sense. Note that I haven't included uncertainty or sample sizes.\n\n\n::: {#cell-fig-basic-subcompartments .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-basic-subcompartments\n#| eval: false\n#| include: false\nliterature_merged_data |>\n  filter(!is.na(MEASURED_UNIT_STANDARD)) |>\n  ggplot(aes(\n    x = MEASURED_VALUE_STANDARD,\n    y = ENVIRON_COMPARTMENT_SUB,\n    color = ENVIRON_COMPARTMENT_SUB\n  )) +\n  geom_point() +\n  facet_nested(\n    rows = vars(ENVIRON_COMPARTMENT, MEASURED_UNIT_STANDARD),\n    scales = \"free_y\",\n    space = \"free_y\",\n    nest_line = element_line()\n  ) +\n  theme_minimal() +\n  scale_color_manual(\n    values = compartment_colours,\n    breaks = names(compartment_colours)\n  ) +\n  theme(legend.position = \"none\") +\n  labs(x = \"\", y = \"\")\n```\n:::\n\n\nThe following sections present copper concentration distributions for each major environmental compartment. Plots are based on reported means uncertainty bounds (SD, range, 95% CI, etc.) and overlaid with relevant regulatory thresholds where available.\n\n### Aquatic Compartment\n\n#### Freshwater\n\n@fig-boxplot-freshwater shows we have a fair amount of data for water. It's not strictly useful to include saltwater, freshwater and inbetween on here, so I think it makes sense to split it - but it won't make a massive difference to the final product.\n\nSome of these units raise some big questions. Why is brackish/transitional using dry? And why are there some aquatic biota using mg/L?\n\n\n::: {#cell-fig-boxplot-freshwater .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-boxplot-freshwater\n#| fig-cap: \"Copper concentrations in water column samples by reference\"\n#| fig-width: 10\n#| eval: false\n#| include: false\n# Calculate sample sizes\nsample_sizes_water <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |>\n  slice(1)\n\n# Create plot\nliterature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB == \"Freshwater\",\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1,\n    vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(\n          ENVIRON_COMPARTMENT_SUB %in% sub_comps,\n          THRESHOLD_TYPE == \"Classification boundary\"\n        )\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |>\n        cross_join(first_facet)\n    },\n    aes(\n      x = THRESHOLD_VALUE,\n      y = Inf,\n      label = THRESHOLD_CLASS,\n      color = THRESHOLD_CLASS\n    ),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n  coord_cartesian(\n    xlim = range(\n      literature_merged_data$UNCERTAINTY_UPPER_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB == \"Freshwater\"\n      ],\n      na.rm = TRUE\n    ) |>\n      round(),\n    clip = \"off\" # allows threshold labels to extend beyond plot area if needed\n  )\n```\n:::\n\n\n#### Salt and Transitional Water\n\n@fig-boxplot-saltwater\n\n\n::: {#cell-fig-boxplot-saltwater .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-boxplot-saltwater\n#| fig-cap: \"Copper concentrations in water column samples by reference\"\n#| fig-width: 10\n#| eval: false\n#| include: false\n# Calculate sample sizes\nchosen_compartments <- c(\"Marine/Salt Water\", \"Brackish/Transitional Water\")\n\nsample_sizes_water <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |>\n  slice(1)\n\n# Create plot\nliterature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1,\n    vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(\n          ENVIRON_COMPARTMENT_SUB %in% sub_comps,\n          THRESHOLD_TYPE == \"Classification boundary\"\n        )\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |>\n        cross_join(first_facet)\n    },\n    aes(\n      x = THRESHOLD_VALUE,\n      y = Inf,\n      label = THRESHOLD_CLASS,\n      color = THRESHOLD_CLASS\n    ),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n  coord_cartesian(\n    xlim = range(\n      literature_merged_data$UNCERTAINTY_UPPER_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |>\n      round(),\n    clip = \"off\" # allows threshold labels to extend beyond plot area if needed\n  )\n```\n:::\n\n\n#### Aquatic Sediment\n\n@fig-boxplot-sediment\n\n\n::: {#cell-fig-boxplot-sediment .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-boxplot-sediment\n#| fig-cap: \"Copper concentrations in aquatic sediment samples by reference\"\n#| fig-width: 10\n#| eval: false\n# Calculate sample sizes\nchosen_compartments <- c(\"Aquatic Sediment\")\n\nsample_sizes_water <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |>\n  slice(1)\n\n# Create plot\nliterature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1,\n    vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(\n          ENVIRON_COMPARTMENT_SUB %in% sub_comps,\n          THRESHOLD_TYPE == \"Classification boundary\"\n        )\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |>\n        cross_join(first_facet)\n    },\n    aes(\n      x = THRESHOLD_VALUE,\n      y = Inf,\n      label = THRESHOLD_CLASS,\n      color = THRESHOLD_CLASS\n    ),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n  coord_cartesian(\n    xlim = range(\n      literature_merged_data$UNCERTAINTY_UPPER_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |>\n      round(),\n    clip = \"off\" # allows threshold labels to extend beyond plot area if needed\n  )\n```\n:::\n\n\n### Terrestrial Compartment\n\nCurrently, data on copper in the terrestrial compartment is limited to one study (@fig-boxplot-terrestrial).\n\n\n::: {#cell-fig-boxplot-terrestrial .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-boxplot-terrestrial\n#| fig-cap: \"Copper concentrations in terrestrial samples by reference\"\n#| fig-width: 10\n#| eval: false\n# Calculate sample sizes\nchosen_compartments <- c(\"Soil O Horizon (Organic)\")\n\nsample_sizes_water <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  calculate_sample_sizes()\n\n# Get first facet for labels\nfirst_facet <- literature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  distinct(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE) |>\n  slice(1)\n\n# Create plot\nliterature_merged_data |>\n  filter(\n    ENVIRON_COMPARTMENT_SUB %in% chosen_compartments,\n    !is.na(MEASURED_OR_IMPUTED_VALUE_STANDARD)\n  ) |>\n  ggplot(aes(\n    x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    y = REFERENCE_ID,\n    colour = ENVIRON_COMPARTMENT_SUB\n  )) +\n  # ... (all your other geoms remain the same) ...\n  geom_crossbar(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"95% Confidence Interval\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    )\n  ) +\n  geom_linerange(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    linewidth = 0.8\n  ) +\n  geom_point(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"Standard Deviation\"),\n    size = 2\n  ) +\n  geom_boxplot(\n    data = \\(x) filter(x, UNCERTAINTY_TYPE == \"1st-3rd Quartile\"),\n    aes(\n      xmin = UNCERTAINTY_LOWER_STANDARD,\n      lower = UNCERTAINTY_LOWER_STANDARD,\n      middle = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n      upper = UNCERTAINTY_UPPER_STANDARD,\n      xmax = UNCERTAINTY_UPPER_STANDARD\n    ),\n    stat = \"identity\"\n  ) +\n  geom_point(\n    alpha = 0.5,\n    data = \\(x) {\n      filter(\n        x,\n        is_not_reported(UNCERTAINTY_TYPE) | is_not_relevant(UNCERTAINTY_TYPE)\n      )\n    }\n  ) +\n  geom_text(\n    data = sample_sizes_water,\n    aes(x = -Inf, y = REFERENCE_ID, label = paste0(\"n=\", total_n)),\n    hjust = -1,\n    vjust = -1,\n    inherit.aes = FALSE,\n    size = 3\n  ) +\n  geom_vline(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(\n          ENVIRON_COMPARTMENT_SUB %in% sub_comps,\n          THRESHOLD_TYPE == \"Classification boundary\"\n        )\n    },\n    aes(xintercept = THRESHOLD_VALUE, color = THRESHOLD_CLASS),\n    linetype = \"dashed\",\n    linewidth = 0.8,\n    alpha = 0.6\n  ) +\n  # Threshold labels - only in first facet\n  geom_text(\n    data = \\(x) {\n      sub_comps <- unique(x$ENVIRON_COMPARTMENT_SUB)\n      copper_toxicity_thresholds |>\n        filter(ENVIRON_COMPARTMENT_SUB %in% sub_comps) |>\n        cross_join(first_facet)\n    },\n    aes(\n      x = THRESHOLD_VALUE,\n      y = Inf,\n      label = THRESHOLD_CLASS,\n      color = THRESHOLD_CLASS\n    ),\n    vjust = 1.5,\n    angle = 90,\n    hjust = 1,\n    size = 3,\n    inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    values = c(threshold_colours, compartment_colours),\n    breaks = names(compartment_colours)\n  ) +\n  labs(\n    x = \"Concentration (mg/L)\",\n    y = \"Reference\",\n    colour = \"Sub-compartment\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"bottom\",\n    legend.box = \"vertical\"\n  ) +\n  facet_nested(\n    rows = vars(OCEAN_COUNTRY, SITE_GEOGRAPHIC_FEATURE),\n    scales = \"free_y\",\n    space = \"free_y\",\n    shrink = TRUE,\n    labeller = label_wrap_gen(width = 15),\n    nest_line = element_line()\n  ) +\n  coord_cartesian(\n    xlim = range(\n      literature_merged_data$UNCERTAINTY_UPPER_STANDARD[\n        literature_merged_data$ENVIRON_COMPARTMENT_SUB %in% chosen_compartments\n      ],\n      na.rm = TRUE\n    ) |>\n      round(),\n    clip = \"off\" # allows threshold labels to extend beyond plot area if needed\n  )\n```\n:::\n\n\n### Biota Compartment\n\n#### Aquatic Biota\n\n presents copper body burdens across different species groups. Note: There appear to be issues with the distribution calculations for biota that require further investigation.\n\n\n::: {#cell-fig-points-biota .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-points-biota\n#| fig-cap: \"Density distributions of copper concentrations in biota, separated by species group. Copper is an essential micronutrient, so baseline concentrations vary widely among taxa. High concentrations may indicate either regulatory adaptation or toxic exposure. Note: Distribution calculations require verification.\"\n#| warning: false\n#| fig-width: 10\n#| fig-height: 10\n#| include: false\n\n# TODO: Fix pls\n# literature_merged_data |>\n#   filter(\n#     ENVIRON_COMPARTMENT == \"Biota\"\n#   ) |>\n#   ggplot(aes(\n#     x = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n#     y = SAMPLE_SPECIES,\n#     colour = SPECIES_GROUP\n#   )) +\n#   geom_pointrange(aes(\n#     xmin = UNCERTAINTY_UPPER_STANDARD,\n#     xmax = UNCERTAINTY_UPPER_STANDARD\n#   )) +\n#   facet_wrap(\n#     facet = vars(OCEAN_COUNTRY),\n#     ncol = 1,\n#     scales = \"free_y\",\n#     space = \"free_y\"\n#   ) |> theme_minimal()\n```\n:::\n\n\n## Temporal Trends\n\n### Abiotic Compartments\n\n@fig-temporal-abiotic examines temporal trends in copper concentrations across abiotic environmental compartments. The current dataset has limited temporal coverage, but these trends may become more apparent as additional data from monitoring databases (e.g., Vannmiljø) are incorporated.\n\n\n::: {#cell-fig-temporal-abiotic .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-temporal-abiotic\n#| fig-cap: \"Temporal trends in copper concentrations across abiotic environmental sub-compartments. Points represent mean values with error bars showing standard deviations. Limited temporal coverage currently restricts trend interpretation, but patterns may emerge with additional historical monitoring data.\"\n#| warning: false\n#| fig-width: 10\n#| fig-height: 12\n#| eval: false\n#| include: false\n\np <- literature_merged_data |>\n  filter(\n    !is.na(MEASURED_UNIT_STANDARD),\n    UNCERTAINTY_TYPE == \"Standard Deviation\",\n    ENVIRON_COMPARTMENT != \"Biota\"\n  ) |>\n  group_by(ENVIRON_COMPARTMENT_SUB, SAMPLE_SPECIES) |>\n  ggplot(aes(\n    x = YEAR,\n    y = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    color = ENVIRON_COMPARTMENT_SUB\n  )) +\n  geom_point() +\n  geom_errorbar(\n    aes(ymin = UNCERTAINTY_LOWER_STANDARD, ymax = UNCERTAINTY_UPPER_STANDARD),\n    width = .2,\n  ) +\n  facet_wrap(\n    facets = vars(ENVIRON_COMPARTMENT_SUB),\n    ncol = 1,\n    scales = \"free_y\"\n  ) +\n  labs(\n    x = \"Year\",\n    y = \"Copper Concentration (standardised units)\",\n    color = \"Sub-compartment\"\n  ) +\n  theme_minimal()\n\n# plotly::ggplotly(p)\np\n```\n:::\n\n\n### Biota\n\n@fig-temporal-biota shows temporal patterns in biotic copper concentrations across species groups. Interpretation should consider both temporal changes in exposure and potential differences in species composition across sampling years.\n\n\n::: {#cell-fig-temporal-biota .cell .hidden}\n\n```{.r .cell-code .hidden}\n#| label: fig-temporal-biota\n#| fig-cap: \"Temporal trends in copper body burdens across different species groups. Points are coloured by species to help distinguish measurement series. Error bars represent reported uncertainty ranges. Vertical facets separate species groups to account for baseline differences in copper accumulation patterns.\"\n#| warning: false\n#| fig-width: 10\n#| fig-height: 12\n#| eval: false\n#| include: false\n\np <- literature_merged_data |>\n  filter(\n    !is.na(MEASURED_UNIT_STANDARD),\n    ENVIRON_COMPARTMENT == \"Biota\"\n  ) |>\n  ggplot(aes(\n    x = YEAR,\n    y = MEASURED_OR_IMPUTED_VALUE_STANDARD,\n    color = SAMPLE_SPECIES\n  )) +\n  geom_point() +\n  geom_errorbar(\n    aes(ymin = UNCERTAINTY_LOWER_STANDARD, ymax = UNCERTAINTY_UPPER_STANDARD),\n    width = .2,\n  ) +\n  facet_wrap(\n    facets = vars(SPECIES_GROUP),\n    ncol = 1,\n    scales = \"free_y\"\n  ) +\n  labs(\n    x = \"Year\",\n    y = \"Copper Concentration (standardised units)\",\n    color = \"Species\"\n  ) +\n  theme_minimal()\n\n# plotly::ggplotly(p)\np\n```\n:::\n\n\n# Network Diagram\n\n\n::: {.cell .hidden}\n\n```{.r .cell-code .hidden}\n#| echo: false\n#| label: setup-network-diagram\n#| fig-width: 16\n#| fig-height: 12\n#| eval: false\n#| include: false\n\nunique_compartments_and_sites <- literature_merged_data |>\n  select(\n    SITE_GEOGRAPHIC_FEATURE,\n    SITE_GEOGRAPHIC_FEATURE_SUB,\n    ENVIRON_COMPARTMENT,\n    ENVIRON_COMPARTMENT_SUB,\n    MEASURED_N\n  ) |>\n  distinct() |>\n  filter(if_all(everything(), ~ !is.na(.))) |>\n  group_by(\n    SITE_GEOGRAPHIC_FEATURE,\n    SITE_GEOGRAPHIC_FEATURE_SUB,\n    ENVIRON_COMPARTMENT,\n    ENVIRON_COMPARTMENT_SUB\n  ) |>\n  reframe(sum_n = sum(MEASURED_N)) |>\n  mutate(compartment_name_n = glue::glue(\"{ENVIRON_COMPARTMENT_SUB}\\n{sum_n}\"))\n\n\n# TODO: This is very speculative and just generated by AI. I haven't yet reviewed it to see what's missing.\n# Copper flow network edges ----\ncopper_flow_edges <- tribble(\n  ~from                         , ~to                           , ~flow_type                , ~plausibility , ~magnitude   , ~evidence_quality , ~description                                                ,\n\n  # Atmospheric deposition to surface waters ----\n  \"Atmospheric\"                 , \"Freshwater\"                  , \"deposition\"              , 0.95          , \"medium\"     , \"high\"            , \"Wet and dry deposition from atmospheric particulates\"      ,\n  \"Atmospheric\"                 , \"Brackish/Transitional Water\" , \"deposition\"              , 0.95          , \"medium\"     , \"high\"            , \"Wet and dry deposition to coastal/estuarine waters\"        ,\n  \"Atmospheric\"                 , \"Aquatic Sediment\"            , \"deposition\"              , 0.90          , \"low\"        , \"medium\"          , \"Direct deposition to exposed sediments\"                    ,\n  \"Atmospheric\"                 , \"Soil O Horizon (Organic)\"    , \"deposition\"              , 0.95          , \"medium\"     , \"high\"            , \"Atmospheric deposition to terrestrial surfaces\"            ,\n\n  # Terrestrial to aquatic flows ----\n  \"Soil O Horizon (Organic)\"    , \"Freshwater\"                  , \"runoff\"                  , 0.95          , \"high\"       , \"high\"            , \"Surface runoff and leaching from soils\"                    ,\n  \"Soil O Horizon (Organic)\"    , \"Groundwater\"                 , \"percolation\"             , 0.85          , \"medium\"     , \"medium\"          , \"Downward migration through soil profile\"                   ,\n  \"Biota, Terrestrial\"          , \"Soil O Horizon (Organic)\"    , \"excretion_decomposition\" , 0.90          , \"low\"        , \"medium\"          , \"Excretion and decomposition of terrestrial organisms\"      ,\n\n  # Groundwater to surface water ----\n  \"Groundwater\"                 , \"Freshwater\"                  , \"baseflow\"                , 0.90          , \"medium\"     , \"high\"            , \"Groundwater discharge to streams/rivers\"                   ,\n  \"Groundwater\"                 , \"Brackish/Transitional Water\" , \"discharge\"               , 0.75          , \"low\"        , \"medium\"          , \"Submarine groundwater discharge to coastal waters\"         ,\n\n  # Freshwater flows ----\n  \"Freshwater\"                  , \"Brackish/Transitional Water\" , \"advection\"               , 0.95          , \"high\"       , \"high\"            , \"River discharge to estuaries\"                              ,\n  \"Freshwater\"                  , \"Aquatic Sediment\"            , \"sedimentation\"           , 0.95          , \"high\"       , \"high\"            , \"Particulate settling from water column\"                    ,\n  \"Freshwater\"                  , \"Biota, Aquatic\"              , \"uptake\"                  , 0.95          , \"medium\"     , \"high\"            , \"Bioaccumulation by freshwater organisms\"                   ,\n\n  # Brackish/transitional water flows ----\n  \"Brackish/Transitional Water\" , \"Aquatic Sediment\"            , \"sedimentation\"           , 0.95          , \"high\"       , \"high\"            , \"Particulate settling in estuarine environments\"            ,\n  \"Brackish/Transitional Water\" , \"Biota, Aquatic\"              , \"uptake\"                  , 0.95          , \"medium\"     , \"high\"            , \"Bioaccumulation by estuarine/coastal organisms\"            ,\n\n  # Sediment processes ----\n  \"Aquatic Sediment\"            , \"Freshwater\"                  , \"resuspension\"            , 0.85          , \"medium\"     , \"high\"            , \"Sediment resuspension and porewater release\"               ,\n  \"Aquatic Sediment\"            , \"Brackish/Transitional Water\" , \"resuspension\"            , 0.85          , \"medium\"     , \"high\"            , \"Sediment resuspension in coastal/estuarine areas\"          ,\n  \"Aquatic Sediment\"            , \"Biota, Aquatic\"              , \"uptake\"                  , 0.90          , \"low\"        , \"medium\"          , \"Benthic organism uptake from sediments\"                    ,\n  \"Aquatic Sediment\"            , \"Groundwater\"                 , \"diagenesis\"              , 0.70          , \"low\"        , \"low\"             , \"Deep burial and diagenetic processes\"                      ,\n\n  # Biota cycling ----\n  \"Biota, Aquatic\"              , \"Aquatic Sediment\"            , \"excretion_decomposition\" , 0.95          , \"medium\"     , \"high\"            , \"Fecal pellets, mortality, decomposition\"                   ,\n  \"Biota, Aquatic\"              , \"Freshwater\"                  , \"excretion\"               , 0.90          , \"low\"        , \"medium\"          , \"Dissolved excretion by aquatic organisms\"                  ,\n  \"Biota, Aquatic\"              , \"Brackish/Transitional Water\" , \"excretion\"               , 0.90          , \"low\"        , \"medium\"          , \"Dissolved excretion in coastal waters\"                     ,\n  \"Biota, Aquatic\"              , \"Biota, Terrestrial\"          , \"trophic_transfer\"        , 0.80          , \"low\"        , \"medium\"          , \"Predation by terrestrial organisms (e.g., birds, mammals)\" ,\n\n  # Wastewater flows ----\n  \"Wastewater\"                  , \"Freshwater\"                  , \"discharge\"               , 0.90          , \"high\"       , \"high\"            , \"Treated or untreated wastewater discharge\"                 ,\n  \"Wastewater\"                  , \"Brackish/Transitional Water\" , \"discharge\"               , 0.80          , \"medium\"     , \"medium\"          , \"Coastal wastewater discharge\"                              ,\n  \"Wastewater\"                  , \"Sludge\"                      , \"treatment\"               , 0.95          , \"high\"       , \"high\"            , \"Copper partitioning to sludge during treatment\"            ,\n\n  # Sludge applications ----\n  \"Sludge\"                      , \"Soil O Horizon (Organic)\"    , \"application\"             , 0.85          , \"medium\"     , \"medium\"          , \"Agricultural application of biosolids\"                     ,\n  \"Sludge\"                      , \"Freshwater\"                  , \"discharge\"               , 0.60          , \"low\"        , \"low\"             , \"Illegal or emergency discharge (historical)\"               ,\n\n  # Terrestrial-atmospheric ----\n  \"Soil O Horizon (Organic)\"    , \"Atmospheric\"                 , \"resuspension\"            , 0.70          , \"low\"        , \"low\"             , \"Wind erosion and dust generation\"                          ,\n  \"Biota, Terrestrial\"          , \"Atmospheric\"                 , \"volatilization\"          , 0.40          , \"negligible\" , \"low\"             , \"Unlikely for copper but included for completeness\"\n)\n\n# Add reverse flow indicators for bidirectional processes if needed ----\n# don't work yet\n# copper_flow_edges |> left_join(unique_compartments_and_sites |> select(ENVIRON_COMPARTMENT_SUB, compartment_name_n), by = \"ENVIRON_COMPARTMENT_SUB\")\n\n# Summary statistics ----\n# copper_flow_edges |>\n#   count(flow_type, sort = TRUE)\n\n# copper_flow_edges |>\n#   count(magnitude)\n\n# Then plot\ngraph <- as_tbl_graph(copper_flow_edges)\n```\n:::\n\n",
    "supporting": [
      "NB03_visualisation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/htmltools-fill-0.5.9/fill.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.34.0/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.2/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.2/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}